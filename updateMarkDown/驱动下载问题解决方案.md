# Metabase é©±åŠ¨ä¸‹è½½é—®é¢˜è§£å†³æ–¹æ¡ˆ

> æ›´æ–°æ—¶é—´: 2025-11-19  
> é—®é¢˜: æ— æ³•ä» AWS S3 ä¸‹è½½æ•°æ®åº“é©±åŠ¨

---

## ğŸ“‹ é—®é¢˜æè¿°

è¿è¡Œ `./bin/build-drivers.sh` æ—¶,æ— æ³•ä¸‹è½½é©±åŠ¨:

```
Downloading: com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.jar from metabase-maven-downloads
```

**åŸå› **: 
- é©±åŠ¨æ‰˜ç®¡åœ¨ AWS S3: `https://s3.amazonaws.com/metabase-maven-downloads`
- å›½å†…è®¿é—® AWS S3 å¯èƒ½å¾ˆæ…¢æˆ–å¤±è´¥
- éœ€è¦ç‰¹æ®Šç½‘ç»œç¯å¢ƒæˆ–æ‰‹åŠ¨ä¸‹è½½

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: è·³è¿‡é©±åŠ¨æ„å»º (æ¨èæ–°æ‰‹)

**å¦‚æœä½ åªæ˜¯æƒ³è¿è¡Œ Metabase,ä¸éœ€è¦ç‰¹æ®Šæ•°æ®åº“é©±åŠ¨**:

```bash
# ç›´æ¥å¯åŠ¨åç«¯,è·³è¿‡é©±åŠ¨æ„å»º
clojure -M:run
```

#### å†…ç½®é©±åŠ¨åˆ—è¡¨

Metabase å·²å†…ç½®ä»¥ä¸‹æ•°æ®åº“é©±åŠ¨,**æ— éœ€é¢å¤–æ„å»º**:

| æ•°æ®åº“ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| H2 | âœ… å†…ç½® | é»˜è®¤æ•°æ®åº“ |
| PostgreSQL | âœ… å†…ç½® | æ¨èç”Ÿäº§ä½¿ç”¨ |
| MySQL | âœ… å†…ç½® | å¸¸ç”¨æ•°æ®åº“ |
| MariaDB | âœ… å†…ç½® | MySQL å…¼å®¹ |
| SQLite | âœ… å†…ç½® | è½»é‡çº§æ•°æ®åº“ |

#### éœ€è¦é¢å¤–æ„å»ºçš„é©±åŠ¨

åªæœ‰è¿æ¥ä»¥ä¸‹æ•°æ®åº“æ—¶æ‰éœ€è¦æ„å»ºé©±åŠ¨:

- AWS Athena
- Google BigQuery
- Snowflake
- Amazon Redshift
- Databricks
- MongoDB
- Presto
- Spark SQL
- Vertica
- ç­‰ç­‰

**åˆ¤æ–­**: å¦‚æœä½ ä¸ç¡®å®šæ˜¯å¦éœ€è¦,å¤§æ¦‚ç‡æ˜¯**ä¸éœ€è¦**çš„ã€‚

---

### æ–¹æ¡ˆ 2: æ‰‹åŠ¨ä¸‹è½½ Athena é©±åŠ¨

å¦‚æœä½ ç¡®å®éœ€è¦ AWS Athena é©±åŠ¨:

#### æ­¥éª¤ 1: ä¸‹è½½é©±åŠ¨æ–‡ä»¶

**æ–¹å¼ A: ä½¿ç”¨æµè§ˆå™¨**

ç›´æ¥è®¿é—®ä»¥ä¸‹ URL ä¸‹è½½:

```
https://s3.amazonaws.com/metabase-maven-downloads/com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.jar
```

**æ–¹å¼ B: ä½¿ç”¨å‘½ä»¤è¡Œ** (éœ€è¦èƒ½è®¿é—® AWS)

```bash
# ä½¿ç”¨ curl
curl -o athena-jdbc-3.6.0.jar \
  https://s3.amazonaws.com/metabase-maven-downloads/com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.jar

# æˆ–ä½¿ç”¨ wget
wget https://s3.amazonaws.com/metabase-maven-downloads/com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.jar
```

**æ–¹å¼ C: ä½¿ç”¨ä»£ç†**

```bash
# è®¾ç½®ä»£ç†
export HTTP_PROXY=http://your-proxy:port
export HTTPS_PROXY=http://your-proxy:port

# ä¸‹è½½
curl -o athena-jdbc-3.6.0.jar \
  https://s3.amazonaws.com/metabase-maven-downloads/com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.jar
```

#### æ­¥éª¤ 2: å®‰è£…åˆ°æœ¬åœ° Maven ä»“åº“

```bash
# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/

# å¤åˆ¶ JAR æ–‡ä»¶
cp athena-jdbc-3.6.0.jar ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/

# éªŒè¯æ–‡ä»¶å­˜åœ¨
ls -lh ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/
```

#### æ­¥éª¤ 3: åˆ›å»º POM æ–‡ä»¶ (å¯é€‰ä½†æ¨è)

```bash
cat > ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/athena-jdbc-3.6.0.pom << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.metabase</groupId>
    <artifactId>athena-jdbc</artifactId>
    <version>3.6.0</version>
    <packaging>jar</packaging>
</project>
EOF
```

#### æ­¥éª¤ 4: é‡æ–°æ„å»ºé©±åŠ¨

```bash
cd /e/github/metabase

# é‡æ–°æ„å»º (ç°åœ¨ä¼šä½¿ç”¨æœ¬åœ°æ–‡ä»¶)
./bin/build-drivers.sh
```

---

### æ–¹æ¡ˆ 3: ä½¿ç”¨ä»£ç†æ„å»º

å¦‚æœä½ æœ‰å¯ç”¨çš„ä»£ç†:

```bash
# è®¾ç½®ä»£ç†ç¯å¢ƒå˜é‡
export HTTP_PROXY=http://your-proxy:port
export HTTPS_PROXY=http://your-proxy:port
export NO_PROXY=localhost,127.0.0.1

# æ„å»ºé©±åŠ¨
./bin/build-drivers.sh

# å®Œæˆåå–æ¶ˆä»£ç†
unset HTTP_PROXY
unset HTTPS_PROXY
```

---

### æ–¹æ¡ˆ 4: ä» AWS å®˜æ–¹ä¸‹è½½ Athena é©±åŠ¨

Athena JDBC é©±åŠ¨ä¹Ÿå¯ä»¥ä» AWS å®˜æ–¹è·å–:

#### æ­¥éª¤ 1: è®¿é—® AWS å®˜æ–¹æ–‡æ¡£

https://docs.aws.amazon.com/athena/latest/ug/jdbc-v3-driver.html#jdbc-v3-driver-download-uber-jar

#### æ­¥éª¤ 2: ä¸‹è½½æœ€æ–°ç‰ˆæœ¬

AWS æä¾›çš„ Athena JDBC é©±åŠ¨å¯èƒ½ç‰ˆæœ¬ä¸åŒ,éœ€è¦è°ƒæ•´:

```bash
# ä¸‹è½½ AWS å®˜æ–¹é©±åŠ¨ (ç¤ºä¾‹)
wget https://athena-downloads.s3.amazonaws.com/drivers/JDBC/SimbaAthenaJDBC-3.6.0.1000/AthenaJDBC43-3.6.0.1000.jar

# é‡å‘½åä¸º Metabase æœŸæœ›çš„åç§°
mv AthenaJDBC43-3.6.0.1000.jar athena-jdbc-3.6.0.jar

# å®‰è£…åˆ°æœ¬åœ°ä»“åº“
mkdir -p ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/
cp athena-jdbc-3.6.0.jar ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/
```

**æ³¨æ„**: AWS å®˜æ–¹ç‰ˆæœ¬å¯èƒ½ä¸ Metabase è¦æ±‚çš„ç‰ˆæœ¬ä¸å®Œå…¨åŒ¹é…,å¯èƒ½éœ€è¦è°ƒæ•´ç‰ˆæœ¬å·ã€‚

---

### æ–¹æ¡ˆ 5: ä¿®æ”¹ deps.edn ä½¿ç”¨æœ¬åœ°æ–‡ä»¶

å¦‚æœä¸‹è½½çš„é©±åŠ¨ç‰ˆæœ¬ä¸åŒ¹é…,å¯ä»¥ä¿®æ”¹é…ç½®:

#### ç¼–è¾‘ `modules/drivers/athena/deps.edn`

```clojure
{:paths
 ["src" "resources"]

 :deps
 ;; ä½¿ç”¨æœ¬åœ° JAR æ–‡ä»¶
 {com.metabase/athena-jdbc {:local/root "/path/to/athena-jdbc-3.6.0.jar"}}}
```

æˆ–è€…ä½¿ç”¨ Maven æœ¬åœ°ä»“åº“:

```clojure
{:paths
 ["src" "resources"]

 :mvn/local-repo "~/.m2/repository"
 
 :deps
 {com.metabase/athena-jdbc {:mvn/version "3.6.0"}}}
```

---

## ğŸ” éªŒè¯é©±åŠ¨å®‰è£…

### æ£€æŸ¥æœ¬åœ° Maven ä»“åº“

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„é©±åŠ¨
ls -lh ~/.m2/repository/com/metabase/athena-jdbc/3.6.0/

# åº”è¯¥çœ‹åˆ°
# athena-jdbc-3.6.0.jar
# athena-jdbc-3.6.0.pom (å¯é€‰)
```

### æ£€æŸ¥é©±åŠ¨æ„å»ºç»“æœ

```bash
# æ„å»ºå®Œæˆå,é©±åŠ¨ä¼šåœ¨è¿™é‡Œ
ls -lh resources/modules/

# åº”è¯¥çœ‹åˆ°
# athena.metabase-driver.jar
```

---

## ğŸ“ å…¶ä»–é©±åŠ¨ä¸‹è½½

å¦‚æœéœ€è¦ä¸‹è½½å…¶ä»–é©±åŠ¨,URL æ ¼å¼:

```
https://s3.amazonaws.com/metabase-maven-downloads/com/metabase/{driver-name}/{version}/{driver-name}-{version}.jar
```

### å¸¸è§é©±åŠ¨åˆ—è¡¨

æŸ¥çœ‹ `modules/drivers/` ç›®å½•ä¸‹çš„å„ä¸ªé©±åŠ¨é…ç½®:

```bash
# åˆ—å‡ºæ‰€æœ‰é©±åŠ¨
ls modules/drivers/

# æŸ¥çœ‹ç‰¹å®šé©±åŠ¨çš„ä¾èµ–
cat modules/drivers/bigquery-cloud-sdk/deps.edn
cat modules/drivers/snowflake/deps.edn
cat modules/drivers/redshift/deps.edn
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢æ€ä¹ˆåŠ?

**A**: ä½¿ç”¨ä¸‹è½½å·¥å…· (å¦‚ IDM, FDM) æˆ–ä»£ç†åŠ é€Ÿã€‚

### Q2: ä¸‹è½½çš„æ–‡ä»¶æ˜¯å¦å®‰å…¨?

**A**: 
- ä» AWS S3 å®˜æ–¹æºä¸‹è½½æ˜¯å®‰å…¨çš„
- å¯ä»¥éªŒè¯æ–‡ä»¶å“ˆå¸Œ (å¦‚æœ Metabase æä¾›)
- æˆ–ä» AWS å®˜æ–¹æ–‡æ¡£è·å–é©±åŠ¨

### Q3: æ˜¯å¦å¯ä»¥è·³è¿‡æŸäº›é©±åŠ¨?

**A**: å¯ä»¥,åªæ„å»ºéœ€è¦çš„é©±åŠ¨:

```bash
# åªæ„å»ºç‰¹å®šé©±åŠ¨
clojure -X:build:drivers:build/drivers :driver :postgres
clojure -X:build:drivers:build/drivers :driver :mysql
```

### Q4: é©±åŠ¨ç‰ˆæœ¬ä¸åŒ¹é…æ€ä¹ˆåŠ?

**A**: 
1. æ£€æŸ¥ `modules/drivers/{driver}/deps.edn` ä¸­çš„ç‰ˆæœ¬è¦æ±‚
2. ä¸‹è½½å¯¹åº”ç‰ˆæœ¬
3. æˆ–ä¿®æ”¹ `deps.edn` ä½¿ç”¨å¯ç”¨ç‰ˆæœ¬

### Q5: Maven æœ¬åœ°ä»“åº“åœ¨å“ª?

**A**: 
- **Linux/Mac**: `~/.m2/repository/`
- **Windows**: `C:\Users\{username}\.m2\repository\`

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨å†…ç½®é©±åŠ¨

å¦‚æœå¯èƒ½,ä½¿ç”¨ Metabase å†…ç½®æ”¯æŒçš„æ•°æ®åº“ (PostgreSQL, MySQL, H2)ã€‚

### 2. æŒ‰éœ€æ„å»ºé©±åŠ¨

åªæ„å»ºå®é™…éœ€è¦çš„é©±åŠ¨,èŠ‚çœæ—¶é—´å’Œç©ºé—´ã€‚

### 3. ä¿å­˜é©±åŠ¨æ–‡ä»¶

ä¸‹è½½çš„é©±åŠ¨ JAR æ–‡ä»¶å¯ä»¥ä¿å­˜å¤‡ç”¨,é¿å…é‡å¤ä¸‹è½½ã€‚

### 4. ä½¿ç”¨ä»£ç†

å¦‚æœç»å¸¸éœ€è¦è®¿é—® AWS èµ„æº,é…ç½®ç¨³å®šçš„ä»£ç†ã€‚

### 5. å®šæœŸæ›´æ–°

é©±åŠ¨ç‰ˆæœ¬ä¼šæ›´æ–°,å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬:
- AWS Athena: https://docs.aws.amazon.com/athena/latest/ug/jdbc-v3-driver.html
- å…¶ä»–é©±åŠ¨: æŸ¥çœ‹ Metabase å®˜æ–¹æ–‡æ¡£

---

## ğŸ“š ç›¸å…³èµ„æº

- [AWS Athena JDBC é©±åŠ¨æ–‡æ¡£](https://docs.aws.amazon.com/athena/latest/ug/jdbc-v3-driver.html)
- [Metabase é©±åŠ¨å¼€å‘æ–‡æ¡£](https://www.metabase.com/docs/latest/developers-guide/drivers)
- [Metabase GitHub - Drivers](https://github.com/metabase/metabase/tree/master/modules/drivers)

---

## ğŸ¯ æ¨èæ–¹æ¡ˆæ€»ç»“

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | éš¾åº¦ |
|------|---------|------|
| åªæ˜¯æƒ³è¯•ç”¨ Metabase | æ–¹æ¡ˆ 1: è·³è¿‡é©±åŠ¨æ„å»º | â­ ç®€å• |
| éœ€è¦ Athena,æœ‰ä»£ç† | æ–¹æ¡ˆ 3: ä½¿ç”¨ä»£ç†æ„å»º | â­â­ ä¸­ç­‰ |
| éœ€è¦ Athena,æ— ä»£ç† | æ–¹æ¡ˆ 2: æ‰‹åŠ¨ä¸‹è½½å®‰è£… | â­â­â­ å¤æ‚ |
| éœ€è¦è‡ªå®šä¹‰ç‰ˆæœ¬ | æ–¹æ¡ˆ 5: ä¿®æ”¹ deps.edn | â­â­â­â­ é«˜çº§ |

---

**å»ºè®®**: å¦‚æœä½ æ˜¯æ–°æ‰‹,å…ˆä½¿ç”¨**æ–¹æ¡ˆ 1**è·³è¿‡é©±åŠ¨æ„å»º,æˆåŠŸè¿è¡Œ Metabase å,å†æ ¹æ®å®é™…éœ€æ±‚æ„å»ºç‰¹å®šé©±åŠ¨ã€‚
