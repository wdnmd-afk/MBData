# 隐藏企业版推销组件指南

> 快速隐藏 Metabase 前端中所有"升级到企业版"的推销信息

---

## 目录

- [什么是 Upsell 组件](#什么是-upsell-组件)
- [会隐藏哪些内容](#会隐藏哪些内容)
- [快速使用](#快速使用)
- [手动修改方法](#手动修改方法)
- [恢复方法](#恢复方法)

---

## 什么是 Upsell 组件

Metabase 在前端使用了一系列 **Upsell** (向上销售) 组件来推广企业版功能。这些组件会在各个页面显示:

- 🔷 "升级到 Pro" 按钮
- 🔷 "更高级的嵌入" 卡片
- 🔷 "嵌入式 React 分析 SDK" 链接
- 🔷 企业版功能介绍
- 🔷 "Try Metabase Pro" 横幅

**位置**: `frontend/src/metabase/admin/upsells/`

---

## 会隐藏哪些内容

### 1. 嵌入相关推销

#### UpsellEmbedHomepage
**显示位置**: 嵌入设置主页

**原始内容**:
```
┌─────────────────────────────────┐
│  More advanced embeds           │
│                                 │
│  Give your customers the full   │
│  power of Metabase in your own │
│  app, with SSO, advanced        │
│  permissions, customization,    │
│  and more.                      │
│                                 │
│  [Try Metabase Pro]             │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

#### UpsellEmbedJsCta
**显示位置**: JavaScript 嵌入设置

**原始内容**:
- "Embed the full Metabase app"
- "Try Metabase Pro" 按钮

**隐藏后**: 不显示

#### UpsellSdkLink
**显示位置**: 嵌入 SDK 相关页面

**原始内容**:
- "嵌入式 React 分析 SDK" 链接
- SDK 功能介绍

**隐藏后**: 不显示

#### UpsellEmbeddingButton
**显示位置**: 嵌入按钮区域

**原始内容**:
- 企业版嵌入功能按钮

**隐藏后**: 不显示

---

### 2. 权限相关推销

#### UpsellPermissions
**显示位置**: 权限设置页面

**原始内容**:
```
┌─────────────────────────────────┐
│  Advanced permissions           │
│                                 │
│  Give different groups access   │
│  to different data with         │
│  sandboxing and more.           │
│                                 │
│  [Learn more]                   │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

---

### 3. SSO 单点登录推销

#### UpsellSSO
**显示位置**: 认证设置页面

**原始内容**:
```
┌─────────────────────────────────┐
│  Enable single sign-on with     │
│  SAML or JWT                    │
│                                 │
│  [Learn more about SSO]         │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

---

### 4. 白标定制推销

#### UpsellWhitelabel
**显示位置**: 外观设置页面

**原始内容**:
```
┌─────────────────────────────────┐
│  Remove "Powered by Metabase"   │
│                                 │
│  Make Metabase truly yours with │
│  white labeling.                │
│                                 │
│  [Learn more]                   │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

#### UpsellEmailWhitelabel
**显示位置**: 邮件设置

**原始内容**:
- 邮件白标功能推销

**隐藏后**: 不显示

---

### 5. 性能和缓存推销

#### UpsellCacheConfig
**显示位置**: 缓存设置页面

**原始内容**:
```
┌─────────────────────────────────┐
│  Granular caching controls      │
│                                 │
│  Pick and choose which questions│
│  to cache for faster performance│
│                                 │
│  [Learn more]                   │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

#### UpsellPerformanceTools
**显示位置**: 性能设置页面

**原始内容**:
- 性能优化工具推销

**隐藏后**: 不显示

---

### 6. 云服务推销

#### UpsellCloud
**显示位置**: 多个页面

**原始内容**:
```
┌─────────────────────────────────┐
│  Metabase Cloud                 │
│                                 │
│  The easiest way to run         │
│  Metabase, fully managed.       │
│                                 │
│  [Try Cloud]                    │
└─────────────────────────────────┘
```

**隐藏后**: 不显示

#### UpsellHosting
**显示位置**: 托管相关页面

**原始内容**:
- 托管服务推销

**隐藏后**: 不显示

---

### 7. 其他企业版功能推销

#### UpsellStorage
**显示位置**: 存储设置

**原始内容**:
- 企业版存储功能

**隐藏后**: 不显示

#### UpsellUploads
**显示位置**: 上传设置

**原始内容**:
- CSV 上传限制提示

**隐藏后**: 不显示

#### UpsellUsageAnalytics
**显示位置**: 分析页面

**原始内容**:
- 使用情况分析推销

**隐藏后**: 不显示

#### UpsellBetterSupport
**显示位置**: 帮助页面

**原始内容**:
- 企业级支持推销

**隐藏后**: 不显示

#### UpsellMetabaseBanner
**显示位置**: 顶部横幅

**原始内容**:
- Metabase 品牌横幅

**隐藏后**: 不显示

#### UpsellSemanticSearch
**显示位置**: 搜索相关

**原始内容**:
- 语义搜索功能推销

**隐藏后**: 不显示

#### UpsellDevInstances
**显示位置**: 开发实例

**原始内容**:
- 开发实例功能推销

**隐藏后**: 不显示

---

## 快速使用

### 方法 1: 使用脚本(推荐)

```bash
# 1. 给脚本添加执行权限
chmod +x hide-enterprise-upsells.sh

# 2. 运行脚本
./hide-enterprise-upsells.sh

# 3. 重新编译前端
yarn build-hot

# 4. 刷新浏览器
```

**完成!** 所有企业版推销组件已被隐藏。

### 脚本做了什么?

1. ✅ 自动备份原始文件
2. ✅ 修改 19 个 Upsell 组件
3. ✅ 让每个组件返回 `null`(不显示任何内容)
4. ✅ 保留文件结构,不影响其他代码

---

## 手动修改方法

如果你想手动修改某个特定组件:

### 示例: 隐藏"更高级的嵌入"

**文件**: `frontend/src/metabase/admin/upsells/UpsellEmbedHomepage.tsx`

**原始代码**:
```typescript
import { t } from "ttag";
import { Text } from "metabase/ui";
import { UpsellCard } from "./components";
import { UPGRADE_URL } from "./constants";

const campaign = "advanced-embeds";

export const UpsellEmbedHomepage = ({ location }: { location: string }) => {
  return (
    <UpsellCard
      title={t`More advanced embeds`}
      campaign={campaign}
      buttonText={t`Try Metabase Pro`}
      buttonLink={UPGRADE_URL}
      location={location}
      style={{
        minWidth: "13.5rem",
        backgroundColor: "transparent",
      }}
    >
      <Text size="sm" lh="md" ta="center">
        {t`Give your customers the full power of Metabase in your own app, with SSO, advanced permissions, customization, and more.`}
      </Text>
    </UpsellCard>
  );
};
```

**修改后**:
```typescript
// 此文件已被修改以隐藏企业版推销内容

export const UpsellEmbedHomepage = () => null;
```

### 对所有组件重复此操作

需要修改的文件列表:
```
frontend/src/metabase/admin/upsells/
├── UpsellEmbedHomepage.tsx        ✅ 更高级的嵌入
├── UpsellEmbedJsCta.tsx           ✅ JS 嵌入推销
├── UpsellSdkLink.tsx              ✅ SDK 链接
├── UpsellEmbeddingButton.tsx      ✅ 嵌入按钮
├── UpsellPermissions.tsx          ✅ 高级权限
├── UpsellSSO.tsx                  ✅ SSO 推销
├── UpsellWhitelabel.tsx           ✅ 白标推销
├── UpsellEmailWhitelabel.tsx      ✅ 邮件白标
├── UpsellCacheConfig.tsx          ✅ 缓存配置
├── UpsellPerformanceTools.tsx     ✅ 性能工具
├── UpsellCloud.tsx                ✅ 云服务
├── UpsellHosting.tsx              ✅ 托管服务
├── UpsellStorage.tsx              ✅ 存储功能
├── UpsellUploads.tsx              ✅ 上传功能
├── UpsellUsageAnalytics.tsx       ✅ 使用分析
├── UpsellBetterSupport.tsx        ✅ 企业支持
├── UpsellMetabaseBanner.tsx       ✅ 品牌横幅
├── UpsellSemanticSearch.tsx       ✅ 语义搜索
└── UpsellDevInstances.tsx         ✅ 开发实例
```

---

## 恢复方法

### 方法 1: 使用备份

脚本会自动创建备份,格式为: `upsells_backup_YYYYMMDD_HHMMSS`

```bash
# 查看备份
ls frontend/src/metabase/admin/upsells_backup_*

# 恢复备份
cp -r frontend/src/metabase/admin/upsells_backup_20251120_092300/* \
      frontend/src/metabase/admin/upsells/

# 重新编译
yarn build-hot
```

### 方法 2: 从 Git 恢复

```bash
# 恢复单个文件
git checkout frontend/src/metabase/admin/upsells/UpsellEmbedHomepage.tsx

# 恢复整个目录
git checkout frontend/src/metabase/admin/upsells/

# 重新编译
yarn build-hot
```

---

## 效果对比

### 修改前

**嵌入设置页面**:
```
┌─────────────────────────────────────────────┐
│  Embedding                                  │
├─────────────────────────────────────────────┤
│                                             │
│  Static embedding                           │
│  [Configure]                                │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  More advanced embeds                 │ │
│  │                                       │ │
│  │  Give your customers the full power   │ │
│  │  of Metabase in your own app...      │ │
│  │                                       │ │
│  │  [Try Metabase Pro]                   │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  Embed the full Metabase app          │ │
│  │  [Try Metabase Pro]                   │ │
│  └───────────────────────────────────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

### 修改后

**嵌入设置页面**:
```
┌─────────────────────────────────────────────┐
│  Embedding                                  │
├─────────────────────────────────────────────┤
│                                             │
│  Static embedding                           │
│  [Configure]                                │
│                                             │
│  (企业版推销卡片已隐藏)                        │
│                                             │
└─────────────────────────────────────────────┘
```

**更简洁,没有推销信息!**

---

## 技术细节

### 为什么这种方法有效?

1. **React 组件特性**: 返回 `null` 的组件不会渲染任何内容
2. **不影响导入**: 组件仍然可以被导入,不会导致编译错误
3. **类型安全**: TypeScript 类型检查仍然通过
4. **最小修改**: 只修改组件实现,不改变接口

### 修改后的组件结构

```typescript
// 原始组件
export const UpsellEmbedHomepage = ({ location }: { location: string }) => {
  return <UpsellCard>...</UpsellCard>;
};

// 修改后
export const UpsellEmbedHomepage = () => null;
```

**关键点**:
- ✅ 组件名称不变
- ✅ 导出方式不变
- ✅ 可以接受任何 props(但会被忽略)
- ✅ 返回 `null`,React 不会渲染任何内容

---

## 常见问题

### Q1: 会影响其他功能吗?

**A**: 不会。这些组件只是推销信息,隐藏它们不会影响 Metabase 的核心功能。

### Q2: 需要重新编译吗?

**A**: 是的,修改 TypeScript/TSX 文件后需要重新编译:
```bash
yarn build-hot
```

### Q3: 会影响性能吗?

**A**: 不会。返回 `null` 的组件几乎没有性能开销。

### Q4: 可以只隐藏某些组件吗?

**A**: 可以。手动修改你想隐藏的组件即可,不需要修改所有组件。

### Q5: Metabase 更新后会恢复吗?

**A**: 如果更新覆盖了这些文件,修改会被恢复。需要重新运行脚本。

### Q6: 有没有更简单的方法?

**A**: 使用 CSS 隐藏也可以,但修改组件更彻底:
- CSS 方法: 组件仍然渲染,只是不可见
- 组件方法: 组件完全不渲染,更干净

---

## 与其他方案对比

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **修改组件(本方案)** | ✅ 彻底<br>✅ 不渲染<br>✅ 性能最好 | ⚠️ 需要重新编译<br>⚠️ 更新可能覆盖 | ⭐⭐⭐⭐⭐ |
| **CSS 隐藏** | ✅ 简单<br>✅ 快速 | ⚠️ 组件仍然渲染<br>⚠️ 可能被绕过 | ⭐⭐⭐⭐ |
| **删除组件文件** | ✅ 最彻底 | ❌ 导致编译错误<br>❌ 需要修改导入 | ❌ 不推荐 |

---

## 最佳实践

### 1. 先备份

```bash
# 手动备份
cp -r frontend/src/metabase/admin/upsells \
      frontend/src/metabase/admin/upsells_backup

# 或使用脚本(自动备份)
./hide-enterprise-upsells.sh
```

### 2. 测试修改

```bash
# 重新编译
yarn build-hot

# 检查是否有编译错误
# 如果有错误,检查修改的文件
```

### 3. 验证效果

访问以下页面确认推销信息已隐藏:
- `/admin/settings/embedding` - 嵌入设置
- `/admin/settings/authentication` - 认证设置
- `/admin/permissions` - 权限设置
- `/admin/appearance` - 外观设置
- `/admin/performance` - 性能设置

### 4. 记录修改

在项目文档中记录这个修改,方便团队其他成员了解。

---

## 总结

### 快速步骤

```bash
# 1. 运行脚本
chmod +x hide-enterprise-upsells.sh
./hide-enterprise-upsells.sh

# 2. 重新编译
yarn build-hot

# 3. 刷新浏览器
```

### 隐藏的内容

✅ 更高级的嵌入  
✅ 嵌入式 React 分析 SDK  
✅ 升级到 Pro/Enterprise 按钮  
✅ SSO 单点登录推销  
✅ 白标定制推销  
✅ 高级权限推销  
✅ 缓存配置推销  
✅ 性能工具推销  
✅ 云托管推销  
✅ 所有其他企业版功能推销  

### 优点

- ✅ 简单快速(5 分钟)
- ✅ 自动备份
- ✅ 不影响功能
- ✅ 可以恢复
- ✅ 性能最优

---

**现在你的 Metabase 界面更简洁了!** 🎉
