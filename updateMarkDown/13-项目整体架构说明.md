# Metabase é¡¹ç›®æ•´ä½“æ¶æ„è¯´æ˜

> ä»é›¶åŸºç¡€ç†è§£ Metabase é¡¹ç›®çš„å®Œæ•´æ¶æ„

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
3. [æ•°æ®æµè½¬](#æ•°æ®æµè½¬)
4. [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)
5. [è¿è¡ŒåŸç†](#è¿è¡ŒåŸç†)
6. [PostgreSQL åŸºç¡€](#postgresql-åŸºç¡€)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### Metabase æ˜¯ä»€ä¹ˆ?

**Metabase** æ˜¯ä¸€ä¸ªå¼€æºçš„å•†ä¸šæ™ºèƒ½(BI)å·¥å…·:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Metabase                   â”‚
â”‚     (å•†ä¸šæ™ºèƒ½åˆ†æå¹³å°)              â”‚
â”‚                                     â”‚
â”‚  åŠŸèƒ½:                              â”‚
â”‚  âœ… è¿æ¥å„ç§æ•°æ®åº“                  â”‚
â”‚  âœ… å¯è§†åŒ–æŸ¥è¯¢(æ— éœ€å†™ SQL)          â”‚
â”‚  âœ… åˆ›å»ºä»ªè¡¨æ¿                      â”‚
â”‚  âœ… ç”ŸæˆæŠ¥è¡¨                        â”‚
â”‚  âœ… æ•°æ®åˆ†æ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨åœºæ™¯

1. **æ•°æ®åˆ†æå¸ˆ**: å¯è§†åŒ–æŸ¥è¯¢æ•°æ®,æ— éœ€å†™ä»£ç 
2. **ä¸šåŠ¡äººå‘˜**: æŸ¥çœ‹å®æ—¶æ•°æ®ä»ªè¡¨æ¿
3. **å¼€å‘äººå‘˜**: å¿«é€Ÿæ­å»ºæ•°æ®åˆ†æå¹³å°
4. **ç®¡ç†å±‚**: æŸ¥çœ‹ä¸šåŠ¡æŠ¥è¡¨å’Œè¶‹åŠ¿

---

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

### 1. Metabase åº”ç”¨(metabase-app)

```yaml
metabase:
  image: metabase/metabase:latest
  container_name: metabase-app
  ports:
    - "3000:3000"
```

**ä½œç”¨**:
- ğŸŒ æä¾› Web ç•Œé¢
- ğŸ” æ‰§è¡Œæ•°æ®æŸ¥è¯¢
- ğŸ“Š ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
- ğŸ‘¥ ç®¡ç†ç”¨æˆ·æƒé™

**è®¿é—®**: `http://localhost:3000`

---

### 2. PostgreSQL æ•°æ®åº“(metabase-postgres)

```yaml
postgres:
  image: postgres:15-alpine
  container_name: metabase-postgres
  volumes:
    - postgres-data:/var/lib/postgresql/data
```

**ä½œç”¨**:
- ğŸ’¾ å­˜å‚¨ Metabase é…ç½®æ•°æ®
- ğŸ‘¤ å­˜å‚¨ç”¨æˆ·è´¦å·
- ğŸ“‹ å­˜å‚¨ä»ªè¡¨æ¿å®šä¹‰
- ğŸ”— å­˜å‚¨æ•°æ®åº“è¿æ¥ä¿¡æ¯

**ä¸æ˜¯**: ä½ è¦åˆ†æçš„ä¸šåŠ¡æ•°æ®åº“

---

### 3. Docker ç½‘ç»œ(metabase-network)

```yaml
networks:
  metabase-network:
```

**ä½œç”¨**:
- ğŸ”— è¿æ¥ Metabase å’Œ PostgreSQL
- ğŸ”’ éš”ç¦»ç½‘ç»œç¯å¢ƒ
- ğŸ“¡ å®¹å™¨é—´é€šä¿¡

---

### 4. Docker å·(postgres-data)

```yaml
volumes:
  postgres-data:
```

**ä½œç”¨**:
- ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨ PostgreSQL æ•°æ®
- ğŸ”„ å®¹å™¨é‡å¯åæ•°æ®ä¸ä¸¢å¤±
- ğŸ“¦ ç‹¬ç«‹äºå®¹å™¨çš„æ•°æ®å­˜å‚¨

---

## ğŸ”„ æ•°æ®æµè½¬

### å®Œæ•´æ•°æ®æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·(ä½ )                                â”‚
â”‚                  æµè§ˆå™¨è®¿é—®                                 â”‚
â”‚              http://localhost:3000                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP è¯·æ±‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Metabase Web åº”ç”¨                              â”‚
â”‚           (metabase-app å®¹å™¨)                               â”‚
â”‚                                                             â”‚
â”‚  ç«¯å£: 3000                                                 â”‚
â”‚  é•œåƒ: metabase/metabase:latest                             â”‚
â”‚  å¤§å°: 1.52 GB                                              â”‚
â”‚                                                             â”‚
â”‚  åŠŸèƒ½:                                                      â”‚
â”‚  â”œâ”€â”€ Web ç•Œé¢(å‰ç«¯)                                         â”‚
â”‚  â”œâ”€â”€ API æœåŠ¡(åç«¯)                                         â”‚
â”‚  â”œâ”€â”€ æŸ¥è¯¢å¼•æ“                                               â”‚
â”‚  â””â”€â”€ å¯è§†åŒ–å¼•æ“                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ 1. è¯»å†™é…ç½®æ•°æ®            â”‚ 2. æŸ¥è¯¢ä¸šåŠ¡æ•°æ®
         â”‚    (ç”¨æˆ·ã€ä»ªè¡¨æ¿ç­‰)        â”‚    (ä½ è¦åˆ†æçš„æ•°æ®)
         â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Metabase å…ƒæ•°æ®åº“      â”‚  â”‚    ä½ çš„ä¸šåŠ¡æ•°æ®åº“           â”‚
â”‚  (metabase-postgres)    â”‚  â”‚   (éœ€è¦æ‰‹åŠ¨æ·»åŠ )            â”‚
â”‚                         â”‚  â”‚                             â”‚
â”‚  PostgreSQL 15          â”‚  â”‚  MySQL / PostgreSQL /       â”‚
â”‚  ç«¯å£: 5432(å†…éƒ¨)       â”‚  â”‚  MongoDB / Excel / ...      â”‚
â”‚  é•œåƒ: postgres:15-alpineâ”‚  â”‚                             â”‚
â”‚  å¤§å°: 390 MB           â”‚  â”‚  å­˜å‚¨: ä½ çš„æœåŠ¡å™¨           â”‚
â”‚                         â”‚  â”‚  æ•°æ®: ä¸šåŠ¡æ•°æ®             â”‚
â”‚  å­˜å‚¨å†…å®¹:              â”‚  â”‚                             â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ·è´¦å·           â”‚  â”‚  Metabase åªè¯»å–,          â”‚
â”‚  â”œâ”€â”€ ä»ªè¡¨æ¿é…ç½®         â”‚  â”‚  ä¸ä¼šä¿®æ”¹ä½ çš„æ•°æ®           â”‚
â”‚  â”œâ”€â”€ æŸ¥è¯¢å®šä¹‰           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”œâ”€â”€ æ•°æ®åº“è¿æ¥ä¿¡æ¯     â”‚
â”‚  â””â”€â”€ æŸ¥è¯¢å†å²           â”‚
â”‚                         â”‚
â”‚  æ•°æ®å­˜å‚¨:              â”‚
â”‚  Docker Volume          â”‚
â”‚  kd_metabase_postgres-dataâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### é¡¹ç›®ç›®å½•ç»“æ„

```
e:\github\metabase\
â”œâ”€â”€ build/                          # éƒ¨ç½²è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ docker-compose.yml          # Docker Compose é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ deploy.sh                   # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ check.sh                    # ç¯å¢ƒæ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ fix.sh                      # ä¿®å¤è„šæœ¬
â”‚   â””â”€â”€ docker-mirror-config.json   # é•œåƒæºé…ç½®
â”‚
â”œâ”€â”€ updateMarkDown/                 # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ 12-æ•°æ®å­˜å‚¨ä½ç½®è¯´æ˜.md
â”‚   â””â”€â”€ 13-é¡¹ç›®æ•´ä½“æ¶æ„è¯´æ˜.md
â”‚
â”œâ”€â”€ metabase.db.mv.db              # H2 æ•°æ®åº“æ–‡ä»¶(æ—§çš„,ä¸å†ä½¿ç”¨)
â”œâ”€â”€ metabase.db.trace.db           # H2 æ—¥å¿—æ–‡ä»¶(æ—§çš„,ä¸å†ä½¿ç”¨)
â”‚
â”œâ”€â”€ docker-compose-simple.yml      # ç®€å•éƒ¨ç½²é…ç½®
â”œâ”€â”€ README.md                      # é¡¹ç›®è¯´æ˜
â””â”€â”€ ... (Metabase æºä»£ç )
```

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

#### 1. docker-compose.yml

**ä½œç”¨**: å®šä¹‰æ‰€æœ‰æœåŠ¡çš„é…ç½®

```yaml
version: '3.9'

services:
  # Metabase åº”ç”¨
  metabase:
    image: metabase/metabase:latest
    container_name: metabase-app
    ports:
      - "3000:3000"
    environment:
      # æ•°æ®åº“è¿æ¥é…ç½®
      MB_DB_TYPE: postgres
      MB_DB_HOST: postgres
      MB_DB_DBNAME: metabase
      MB_DB_USER: metabase
      MB_DB_PASS: metabase_password
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - metabase-network

  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: metabase-postgres
    environment:
      POSTGRES_USER: metabase
      POSTGRES_PASSWORD: metabase_password
      POSTGRES_DB: metabase
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - metabase-network

volumes:
  postgres-data:

networks:
  metabase-network:
```

#### 2. .env

**ä½œç”¨**: ç¯å¢ƒå˜é‡é…ç½®

```bash
# é¡¹ç›®åç§°
COMPOSE_PROJECT_NAME=kd_metabase

# æ•°æ®åº“é…ç½®
MB_DB_TYPE=postgres
MB_DB_USER=metabase
MB_DB_PASS=metabase_password

# æ—¶åŒºé…ç½®
TZ=Asia/Shanghai
```

---

## âš™ï¸ è¿è¡ŒåŸç†

### å¯åŠ¨æµç¨‹

```
1. è¿è¡Œ ./deploy.sh
   â†“
2. æ‰§è¡Œ docker-compose up -d
   â†“
3. Docker è¯»å– docker-compose.yml
   â†“
4. åˆ›å»ºç½‘ç»œ: kd_metabase_metabase-network
   â†“
5. åˆ›å»ºå·: kd_metabase_postgres-data
   â†“
6. å¯åŠ¨ PostgreSQL å®¹å™¨
   â”œâ”€â”€ æ‹‰å–é•œåƒ: postgres:15-alpine
   â”œâ”€â”€ åˆ›å»ºå®¹å™¨: metabase-postgres
   â”œâ”€â”€ åˆå§‹åŒ–æ•°æ®åº“
   â””â”€â”€ ç­‰å¾…å¥åº·æ£€æŸ¥é€šè¿‡
   â†“
7. å¯åŠ¨ Metabase å®¹å™¨
   â”œâ”€â”€ æ‹‰å–é•œåƒ: metabase/metabase:latest
   â”œâ”€â”€ åˆ›å»ºå®¹å™¨: metabase-app
   â”œâ”€â”€ è¿æ¥åˆ° PostgreSQL
   â”œâ”€â”€ åˆå§‹åŒ–æ•°æ®åº“è¡¨
   â””â”€â”€ å¯åŠ¨ Web æœåŠ¡
   â†“
8. éƒ¨ç½²å®Œæˆ
   â””â”€â”€ è®¿é—® http://localhost:3000
```

### å®¹å™¨é€šä¿¡

```
metabase-app å®¹å™¨
â”œâ”€â”€ ç¯å¢ƒå˜é‡: MB_DB_HOST=postgres
â”œâ”€â”€ DNS è§£æ: postgres -> metabase-postgres å®¹å™¨ IP
â””â”€â”€ è¿æ¥: metabase-postgres:5432

metabase-postgres å®¹å™¨
â”œâ”€â”€ ç›‘å¬ç«¯å£: 5432
â”œâ”€â”€ æ¥å—è¿æ¥: æ¥è‡ª metabase-app
â””â”€â”€ è¿”å›æ•°æ®: æŸ¥è¯¢ç»“æœ
```

---

## ğŸ˜ PostgreSQL åŸºç¡€

### ä»€ä¹ˆæ˜¯ PostgreSQL?

**PostgreSQL** æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºå…³ç³»å‹æ•°æ®åº“:

```
PostgreSQL
â”œâ”€â”€ ç±»å‹: å…³ç³»å‹æ•°æ®åº“(RDBMS)
â”œâ”€â”€ ç‰¹ç‚¹: å¼€æºã€åŠŸèƒ½å¼ºå¤§ã€ç¨³å®šå¯é 
â”œâ”€â”€ ç”¨é€”: å­˜å‚¨ç»“æ„åŒ–æ•°æ®
â””â”€â”€ ç±»ä¼¼: MySQLã€Oracleã€SQL Server
```

### åŸºæœ¬æ¦‚å¿µ

#### 1. æ•°æ®åº“(Database)

```
æ•°æ®åº“ = æ•°æ®çš„é›†åˆ

ä¾‹å¦‚: metabase æ•°æ®åº“
â”œâ”€â”€ å­˜å‚¨ Metabase çš„æ‰€æœ‰æ•°æ®
â””â”€â”€ åŒ…å«å¤šä¸ªè¡¨
```

#### 2. è¡¨(Table)

```
è¡¨ = æ•°æ®çš„ç»“æ„åŒ–å­˜å‚¨

ä¾‹å¦‚: core_user è¡¨(ç”¨æˆ·è¡¨)
â”œâ”€â”€ id: ç”¨æˆ·ID
â”œâ”€â”€ email: é‚®ç®±
â”œâ”€â”€ password: å¯†ç 
â””â”€â”€ created_at: åˆ›å»ºæ—¶é—´
```

#### 3. è¡Œ(Row)

```
è¡Œ = ä¸€æ¡æ•°æ®è®°å½•

ä¾‹å¦‚: ä¸€ä¸ªç”¨æˆ·
id=1, email=admin@example.com, password=xxx
```

#### 4. åˆ—(Column)

```
åˆ— = æ•°æ®çš„å­—æ®µ

ä¾‹å¦‚: email åˆ—
å­˜å‚¨æ‰€æœ‰ç”¨æˆ·çš„é‚®ç®±åœ°å€
```

### PostgreSQL åœ¨é¡¹ç›®ä¸­çš„ä½œç”¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PostgreSQL æ•°æ®åº“             â”‚
â”‚                                     â”‚
â”‚  æ•°æ®åº“: metabase                   â”‚
â”‚  â”œâ”€â”€ è¡¨: core_user (ç”¨æˆ·)          â”‚
â”‚  â”œâ”€â”€ è¡¨: report_dashboard (ä»ªè¡¨æ¿) â”‚
â”‚  â”œâ”€â”€ è¡¨: report_card (æŸ¥è¯¢)        â”‚
â”‚  â”œâ”€â”€ è¡¨: metabase_database (è¿æ¥)  â”‚
â”‚  â””â”€â”€ ... (å…¶ä»–è¡¨)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¸¸ç”¨æ“ä½œ

#### è¿æ¥æ•°æ®åº“

```bash
# è¿›å…¥ PostgreSQL å®¹å™¨
docker exec -it metabase-postgres psql -U metabase -d metabase
```

#### æŸ¥çœ‹æ‰€æœ‰è¡¨

```sql
\dt
```

**è¾“å‡ºç¤ºä¾‹**:
```
              List of relations
 Schema |         Name          | Type  |  Owner   
--------+-----------------------+-------+----------
 public | core_user             | table | metabase
 public | report_dashboard      | table | metabase
 public | report_card           | table | metabase
 ...
```

#### æŸ¥çœ‹è¡¨ç»“æ„

```sql
\d core_user
```

#### æŸ¥è¯¢æ•°æ®

```sql
-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT id, email, first_name, last_name FROM core_user;

-- æŸ¥çœ‹ä»ªè¡¨æ¿æ•°é‡
SELECT COUNT(*) FROM report_dashboard;
```

#### é€€å‡º

```sql
\q
```

---

## ğŸ” æ•°æ®å­˜å‚¨è¯¦è§£

### ä¸‰å±‚æ•°æ®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¬¬ 1 å±‚: åº”ç”¨å±‚                       â”‚
â”‚                                                         â”‚
â”‚  Metabase Web åº”ç”¨                                      â”‚
â”‚  - ç”¨æˆ·ç•Œé¢                                             â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘                                             â”‚
â”‚  - API æ¥å£                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ JDBC è¿æ¥
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¬¬ 2 å±‚: æ•°æ®åº“å±‚                     â”‚
â”‚                                                         â”‚
â”‚  PostgreSQL æ•°æ®åº“                                      â”‚
â”‚  - æ•°æ®åº“å¼•æ“                                           â”‚
â”‚  - SQL æŸ¥è¯¢å¤„ç†                                         â”‚
â”‚  - äº‹åŠ¡ç®¡ç†                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ æ–‡ä»¶ç³»ç»Ÿ
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¬¬ 3 å±‚: å­˜å‚¨å±‚                       â”‚
â”‚                                                         â”‚
â”‚  Docker Volume                                          â”‚
â”‚  - ç‰©ç†å­˜å‚¨                                             â”‚
â”‚  - æ•°æ®æ–‡ä»¶                                             â”‚
â”‚  - æŒä¹…åŒ–                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æ–‡ä»¶ä½ç½®

#### Docker Volume å†…éƒ¨ç»“æ„

```
kd_metabase_postgres-data/
â”œâ”€â”€ base/                    # æ•°æ®åº“æ–‡ä»¶
â”‚   â””â”€â”€ 16384/              # metabase æ•°æ®åº“
â”‚       â”œâ”€â”€ 16385           # core_user è¡¨æ•°æ®
â”‚       â”œâ”€â”€ 16386           # report_dashboard è¡¨æ•°æ®
â”‚       â””â”€â”€ ...
â”œâ”€â”€ global/                  # å…¨å±€æ•°æ®
â”œâ”€â”€ pg_wal/                  # äº‹åŠ¡æ—¥å¿—
â””â”€â”€ postgresql.conf          # é…ç½®æ–‡ä»¶
```

---

## ğŸ¯ å…³é”®æ¦‚å¿µæ€»ç»“

### 1. Metabase ä¸å­˜å‚¨ä¸šåŠ¡æ•°æ®

```
âŒ é”™è¯¯ç†è§£:
Metabase æŠŠæˆ‘çš„ä¸šåŠ¡æ•°æ®å¤åˆ¶ä¸€ä»½å­˜èµ·æ¥

âœ… æ­£ç¡®ç†è§£:
Metabase åªæ˜¯è¿æ¥åˆ°ä½ çš„æ•°æ®åº“,å®æ—¶æŸ¥è¯¢æ•°æ®
```

### 2. ä¸¤ä¸ªæ•°æ®åº“çš„åŒºåˆ«

| é¡¹ç›® | Metabase å…ƒæ•°æ®åº“ | ä¸šåŠ¡æ•°æ®åº“ |
|------|------------------|-----------|
| **ä½ç½®** | Docker å®¹å™¨å†… | ä½ çš„æœåŠ¡å™¨ |
| **ç”¨é€”** | å­˜å‚¨ Metabase é…ç½® | å­˜å‚¨ä¸šåŠ¡æ•°æ® |
| **æ•°æ®** | ç”¨æˆ·ã€ä»ªè¡¨æ¿ç­‰ | è®¢å•ã€ç”¨æˆ·ç­‰ |
| **ä¿®æ”¹** | Metabase ä¼šä¿®æ”¹ | Metabase åªè¯» |
| **å¤‡ä»½** | éœ€è¦å¤‡ä»½ | ä½ è‡ªå·±å¤‡ä»½ |

### 3. H2 vs PostgreSQL

```
H2 æ•°æ®åº“:
â”œâ”€â”€ æ–‡ä»¶: metabase.db.mv.db
â”œâ”€â”€ ç”¨é€”: æµ‹è¯•å’Œå¼€å‘
â””â”€â”€ çŠ¶æ€: ä¸å†ä½¿ç”¨

PostgreSQL:
â”œâ”€â”€ ä½ç½®: Docker Volume
â”œâ”€â”€ ç”¨é€”: ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ çŠ¶æ€: å½“å‰ä½¿ç”¨
```

---

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¨‹

### 1. åˆæ¬¡éƒ¨ç½²

```bash
# 1. å¯åŠ¨æœåŠ¡
./deploy.sh

# 2. Docker åˆ›å»º
- ç½‘ç»œ: kd_metabase_metabase-network
- å·: kd_metabase_postgres-data
- å®¹å™¨: metabase-postgres, metabase-app

# 3. PostgreSQL åˆå§‹åŒ–
- åˆ›å»ºæ•°æ®åº“: metabase
- åˆ›å»ºç”¨æˆ·: metabase

# 4. Metabase åˆå§‹åŒ–
- è¿æ¥ PostgreSQL
- åˆ›å»ºæ•°æ®è¡¨
- å¯åŠ¨ Web æœåŠ¡
```

### 2. é¦–æ¬¡è®¿é—®

```
1. è®¿é—® http://localhost:3000
   â†“
2. é€‰æ‹©è¯­è¨€: ä¸­æ–‡
   â†“
3. åˆ›å»ºç®¡ç†å‘˜è´¦å·
   - é‚®ç®±: admin@example.com
   - å¯†ç : ********
   â†“
4. (å¯é€‰)æ·»åŠ æ•°æ®æº
   - é€‰æ‹©æ•°æ®åº“ç±»å‹: MySQL/PostgreSQL/...
   - è¾“å…¥è¿æ¥ä¿¡æ¯
   â†“
5. å¼€å§‹ä½¿ç”¨
   - åˆ›å»ºæŸ¥è¯¢
   - åˆ›å»ºä»ªè¡¨æ¿
   - åˆ†ææ•°æ®
```

### 3. æ—¥å¸¸ä½¿ç”¨

```
ç”¨æˆ·è®¿é—® Metabase
   â†“
åˆ›å»ºæŸ¥è¯¢/æŸ¥çœ‹ä»ªè¡¨æ¿
   â†“
Metabase æ‰§è¡Œä»¥ä¸‹æ“ä½œ:
   â”œâ”€â”€ 1. ä» PostgreSQL è¯»å–æŸ¥è¯¢å®šä¹‰
   â”œâ”€â”€ 2. è¿æ¥åˆ°ä¸šåŠ¡æ•°æ®åº“
   â”œâ”€â”€ 3. æ‰§è¡Œ SQL æŸ¥è¯¢
   â”œâ”€â”€ 4. è·å–æ•°æ®
   â”œâ”€â”€ 5. ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
   â””â”€â”€ 6. è¿”å›ç»™ç”¨æˆ·
```

---

## ğŸ†˜ å¸¸è§ç–‘é—®è§£ç­”

### Q1: PostgreSQL æ˜¯ä»€ä¹ˆ?

**A**: PostgreSQL æ˜¯ä¸€ä¸ªæ•°æ®åº“è½¯ä»¶,å°±åƒ MySQLã€Oracle ä¸€æ ·,ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚

### Q2: ä¸ºä»€ä¹ˆéœ€è¦ PostgreSQL?

**A**: Metabase éœ€è¦ä¸€ä¸ªåœ°æ–¹å­˜å‚¨å®ƒè‡ªå·±çš„é…ç½®æ•°æ®(ç”¨æˆ·ã€ä»ªè¡¨æ¿ç­‰),PostgreSQL å°±æ˜¯è¿™ä¸ªå­˜å‚¨çš„åœ°æ–¹ã€‚

### Q3: æˆ‘çš„ä¸šåŠ¡æ•°æ®åœ¨å“ªé‡Œ?

**A**: åœ¨ä½ è‡ªå·±çš„æ•°æ®åº“æœåŠ¡å™¨ä¸Š,Metabase ä¸ä¼šæŠŠä½ çš„ä¸šåŠ¡æ•°æ®å¤åˆ¶ä¸€ä»½ã€‚

### Q4: H2 æ–‡ä»¶å¯ä»¥åˆ é™¤å—?

**A**: å¯ä»¥,é‚£æ˜¯æ—§çš„æµ‹è¯•æ•°æ®,ç°åœ¨ç”¨ PostgreSQL äº†ã€‚

### Q5: æ•°æ®ä¼šä¸¢å¤±å—?

**A**: åªè¦ä¸åˆ é™¤ Docker Volume,æ•°æ®å°±ä¸ä¼šä¸¢å¤±ã€‚

### Q6: å¦‚ä½•å¤‡ä»½æ•°æ®?

**A**: ä½¿ç”¨ pg_dump å¤‡ä»½ PostgreSQL æ•°æ®åº“:

```bash
docker exec metabase-postgres pg_dump -U metabase metabase > backup.sql
```

### Q7: å¦‚ä½•æŸ¥çœ‹ PostgreSQL æ•°æ®?

**A**: è¿›å…¥å®¹å™¨ä½¿ç”¨ psql:

```bash
docker exec -it metabase-postgres psql -U metabase -d metabase
```

---

## âœ… æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **Metabase æ˜¯ä»€ä¹ˆ**
   - å•†ä¸šæ™ºèƒ½åˆ†æå·¥å…·
   - å¯è§†åŒ–æŸ¥è¯¢å’Œä»ªè¡¨æ¿
   - è¿æ¥å„ç§æ•°æ®åº“

2. **æ•°æ®å­˜å‚¨**
   - Metabase é…ç½®: PostgreSQL (Docker Volume)
   - ä¸šåŠ¡æ•°æ®: ä½ è‡ªå·±çš„æ•°æ®åº“
   - H2 æ–‡ä»¶: æ—§çš„,ä¸å†ä½¿ç”¨

3. **PostgreSQL ä½œç”¨**
   - å­˜å‚¨ Metabase é…ç½®
   - ä¸å­˜å‚¨ä¸šåŠ¡æ•°æ®
   - ç”Ÿäº§ç¯å¢ƒæ¨è

4. **é¡¹ç›®æ¶æ„**
   - metabase-app: Web åº”ç”¨
   - metabase-postgres: é…ç½®æ•°æ®åº“
   - Docker Volume: æŒä¹…åŒ–å­˜å‚¨

---

**ç°åœ¨ä½ å®Œå…¨ç†è§£ Metabase é¡¹ç›®çš„æ•´ä½“æ¶æ„äº†!** ğŸ‰ğŸ“Šâœ¨
